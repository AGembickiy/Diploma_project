#!/usr/bin/env python
"""
–°–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫
"""

import os
import sys
import django
from django.utils import timezone
from datetime import timedelta

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'mmorpg_backend.settings')
django.setup()

from newsletters.models import Newsletter, NewsletterTemplate
from users.models import User


def create_newsletter_templates():
    """–°–æ–∑–¥–∞—Ç—å —à–∞–±–ª–æ–Ω—ã —Ä–∞—Å—Å—ã–ª–æ–∫"""
    templates_data = [
        {
            'name': '–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',
            'subject': '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MMORPG Board!',
            'content': '''
–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä MMORPG Board!

–ú—ã —Ä–∞–¥—ã –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤–∞—Å –≤ –Ω–∞—à–µ–º —Å–æ–æ–±—â–µ—Å—Ç–≤–µ –∏–≥—Ä–æ–∫–æ–≤. –ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ:

üéÆ –°–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ –ø–æ–∏—Å–∫–µ –∫–æ–º–∞–Ω–¥—ã
üë• –ù–∞—Ö–æ–¥–∏—Ç—å –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –∏–≥—Ä—ã
üì¢ –û–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –æ–ø—ã—Ç–æ–º –∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏
üèÜ –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö –∏ —Å–æ–±—ã—Ç–∏—è—Ö

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å –∏ —Å–æ–∑–¥–∞—Ç—å –ø–µ—Ä–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ!

–£–¥–∞—á–Ω–æ–π –∏–≥—Ä—ã!
–ö–æ–º–∞–Ω–¥–∞ MMORPG Board
            '''
        },
        {
            'name': '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞',
            'subject': '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ MMORPG Board',
            'content': '''
–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ MMORPG Board

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –Ω–µ–¥–µ–ª—é:
‚Ä¢ –ù–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: {new_users_count}
‚Ä¢ –°–æ–∑–¥–∞–Ω–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π: {advertisements_count}
‚Ä¢ –£—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–∫–ª–∏–∫–æ–≤: {responses_count}

üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
{popular_categories}

üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
‚Ä¢ –û–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–≤–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Ä–µ–≥—É–ª—è—Ä–Ω–æ
‚Ä¢ –û—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –æ—Ç–∫–ª–∏–∫–∏ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ
‚Ä¢ –£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è—Ö

–°–ø–∞—Å–∏–±–æ –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å!
–ö–æ–º–∞–Ω–¥–∞ MMORPG Board
            '''
        },
        {
            'name': '–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ç—É—Ä–Ω–∏—Ä–µ',
            'subject': '–ù–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä –≤ MMORPG Board!',
            'content': '''
üèÜ –ù–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä –≤ MMORPG Board!

–ü—Ä–∏–≥–ª–∞—à–∞–µ–º –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –Ω–æ–≤–æ–º —Ç—É—Ä–Ω–∏—Ä–µ!

üìÖ –î–∞—Ç–∞: {tournament_date}
‚è∞ –í—Ä–µ–º—è: {tournament_time}
üéÆ –ò–≥—Ä–∞: {game_name}
üí∞ –ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥: {prize_pool}

üìã –ü—Ä–∞–≤–∏–ª–∞:
‚Ä¢ –ö–æ–º–∞–Ω–¥—ã –ø–æ 5 —á–µ–ª–æ–≤–µ–∫
‚Ä¢ –û–¥–∏–Ω –∏–≥—Ä–æ–∫ - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
‚Ä¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–æ {registration_deadline}

üéØ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: {registration_link}

–ù–µ —É–ø—É—Å—Ç–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏!
–ö–æ–º–∞–Ω–¥–∞ MMORPG Board
            '''
        },
        {
            'name': '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã',
            'subject': '–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã MMORPG Board',
            'content': '''
üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã MMORPG Board

–ú—ã –æ–±–Ω–æ–≤–∏–ª–∏ –Ω–∞—à—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—É! –í–æ—Ç —á—Ç–æ –Ω–æ–≤–æ–≥–æ:

‚ú® –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
‚Ä¢ –£–ª—É—á—à–µ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
‚Ä¢ –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏
‚Ä¢ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
‚Ä¢ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
‚Ä¢ –£–ª—É—á—à–µ–Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–µ–ª–∫–∏–µ –æ—à–∏–±–∫–∏
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω –¥–∏–∑–∞–π–Ω

üì± –ú–æ–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è:
‚Ä¢ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
‚Ä¢ –ë—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
‚Ä¢ –£–¥–æ–±–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

–°–ø–∞—Å–∏–±–æ –∑–∞ —Ç–µ—Ä–ø–µ–Ω–∏–µ!
–ö–æ–º–∞–Ω–¥–∞ MMORPG Board
            '''
        }
    ]
    
    created_templates = []
    for template_data in templates_data:
        template, created = NewsletterTemplate.objects.get_or_create(
            name=template_data['name'],
            defaults=template_data
        )
        if created:
            print(f"‚úÖ –°–æ–∑–¥–∞–Ω —à–∞–±–ª–æ–Ω: {template.name}")
        else:
            print(f"‚ÑπÔ∏è  –®–∞–±–ª–æ–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {template.name}")
        created_templates.append(template)
    
    return created_templates


def create_newsletters():
    """–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏"""
    # –ü–æ–ª—É—á–∞–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    admin_user = User.objects.filter(is_staff=True).first()
    if not admin_user:
        print("‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫")
        return
    
    newsletters_data = [
        {
            'title': '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MMORPG Board!',
            'subject': '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ',
            'content': '''
–î–æ—Ä–æ–≥–∏–µ –∏–≥—Ä–æ–∫–∏!

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MMORPG Board - –≤–∞—à—É –ø–ª–∞—Ç—Ñ–æ—Ä–º—É –¥–ª—è –ø–æ–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥—ã –∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤ –≤ –º–∏—Ä–µ MMORPG –∏–≥—Ä!

üéÆ –ß—Ç–æ –≤—ã –º–æ–∂–µ—Ç–µ –¥–µ–ª–∞—Ç—å:
‚Ä¢ –°–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –æ –ø–æ–∏—Å–∫–µ –∫–æ–º–∞–Ω–¥—ã
‚Ä¢ –û—Ç–∫–ª–∏–∫–∞—Ç—å—Å—è –Ω–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
‚Ä¢ –û–±—â–∞—Ç—å—Å—è —Å –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–∞–º–∏
‚Ä¢ –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ç—É—Ä–Ω–∏—Ä–∞—Ö –∏ —Å–æ–±—ã—Ç–∏—è—Ö

üìã –ù–∞—á–Ω–∏—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:
1. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–≤–æ–π –ø—Ä–æ—Ñ–∏–ª—å
2. –°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
3. –ù–∞–π–¥–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–π –∏–≥—Ä—ã

–£–¥–∞—á–Ω–æ–π –∏–≥—Ä—ã!
–ö–æ–º–∞–Ω–¥–∞ MMORPG Board
            ''',
            'send_to_new': True
        },
        {
            'title': '–ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–∞—è —Å–≤–æ–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏',
            'subject': '–í–∞—à–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é',
            'content': '''
–ü—Ä–∏–≤–µ—Ç, –∏–≥—Ä–æ–∫–∏!

–í–æ—Ç —Å–≤–æ–¥–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∑–∞ –ø—Ä–æ—à–µ–¥—à—É—é –Ω–µ–¥–µ–ª—é:

üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
‚Ä¢ –ù–æ–≤—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π: 47
‚Ä¢ –£—Å–ø–µ—à–Ω—ã—Ö –æ—Ç–∫–ª–∏–∫–æ–≤: 23
‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 156

üî• –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
1. –¢–∞–Ω–∫–∏ - 15 –æ–±—ä—è–≤–ª–µ–Ω–∏–π
2. –î–î - 12 –æ–±—ä—è–≤–ª–µ–Ω–∏–π
3. –•–∏–ª—ã - 8 –æ–±—ä—è–≤–ª–µ–Ω–∏–π

üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
‚Ä¢ –û–±–Ω–æ–≤–ª—è–π—Ç–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 3-5 –¥–Ω–µ–π
‚Ä¢ –û—Ç–≤–µ—á–∞–π—Ç–µ –Ω–∞ –æ—Ç–∫–ª–∏–∫–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 24 —á–∞—Å–æ–≤
‚Ä¢ –£—á–∞—Å—Ç–≤—É–π—Ç–µ –≤ –æ–±—Å—É–∂–¥–µ–Ω–∏—è—Ö

–°–ø–∞—Å–∏–±–æ –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å!
–ö–æ–º–∞–Ω–¥–∞ MMORPG Board
            ''',
            'send_to_active': True
        },
        {
            'title': '–ù–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä: "–ë–∏—Ç–≤–∞ –∫–ª–∞–Ω–æ–≤"',
            'subject': '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ —Ç—É—Ä–Ω–∏—Ä –æ—Ç–∫—Ä—ã—Ç–∞!',
            'content': '''
üèÜ –¢—É—Ä–Ω–∏—Ä "–ë–∏—Ç–≤–∞ –∫–ª–∞–Ω–æ–≤" - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∞!

–ü—Ä–∏–≥–ª–∞—à–∞–µ–º –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ MMORPG Board –ø—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –Ω–æ–≤–æ–º —Ç—É—Ä–Ω–∏—Ä–µ!

üìÖ –î–∞—Ç–∞: 15 –¥–µ–∫–∞–±—Ä—è 2024
‚è∞ –í—Ä–µ–º—è: 20:00 –ú–°–ö
üéÆ –§–æ—Ä–º–∞—Ç: 5x5 –∫–æ–º–∞–Ω–¥–Ω—ã–µ –±–æ–∏
üí∞ –ü—Ä–∏–∑–æ–≤–æ–π —Ñ–æ–Ω–¥: 50,000 —Ä—É–±–ª–µ–π

üìã –ü—Ä–∞–≤–∏–ª–∞ —Ç—É—Ä–Ω–∏—Ä–∞:
‚Ä¢ –ö–æ–º–∞–Ω–¥—ã –ø–æ 5 —á–µ–ª–æ–≤–µ–∫
‚Ä¢ –û–¥–∏–Ω –∏–≥—Ä–æ–∫ - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞
‚Ä¢ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –¥–æ 10 –¥–µ–∫–∞–±—Ä—è
‚Ä¢ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç—á–∏ 12-14 –¥–µ–∫–∞–±—Ä—è

üéØ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è: https://mmorpg-board.ru/tournament

–ù–µ —É–ø—É—Å—Ç–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–∫–∞–∑–∞—Ç—å —Å–≤–æ–∏ –Ω–∞–≤—ã–∫–∏ –∏ –≤—ã–∏–≥—Ä–∞—Ç—å –ø—Ä–∏–∑—ã!

–£–¥–∞—á–∏ –≤ –±–æ—é!
–ö–æ–º–∞–Ω–¥–∞ MMORPG Board
            ''',
            'send_to_all': True
        }
    ]
    
    created_newsletters = []
    for newsletter_data in newsletters_data:
        newsletter, created = Newsletter.objects.get_or_create(
            title=newsletter_data['title'],
            defaults={
                **newsletter_data,
                'created_by': admin_user,
                'status': 'draft'
            }
        )
        if created:
            print(f"‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Ä–∞—Å—Å—ã–ª–∫–∞: {newsletter.title}")
        else:
            print(f"‚ÑπÔ∏è  –†–∞—Å—Å—ã–ª–∫–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: {newsletter.title}")
        created_newsletters.append(newsletter)
    
    return created_newsletters


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    print("üöÄ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –Ω–æ–≤–æ—Å—Ç–Ω—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫...")
    
    # –°–æ–∑–¥–∞–µ–º —à–∞–±–ª–æ–Ω—ã
    print("\nüìù –°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ —Ä–∞—Å—Å—ã–ª–æ–∫...")
    templates = create_newsletter_templates()
    
    # –°–æ–∑–¥–∞–µ–º —Ä–∞—Å—Å—ã–ª–∫–∏
    print("\nüìß –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫...")
    newsletters = create_newsletters()
    
    print(f"\n‚úÖ –ì–æ—Ç–æ–≤–æ! –°–æ–∑–¥–∞–Ω–æ:")
    print(f"   ‚Ä¢ –®–∞–±–ª–æ–Ω–æ–≤: {len(templates)}")
    print(f"   ‚Ä¢ –†–∞—Å—Å—ã–ª–æ–∫: {len(newsletters)}")
    print(f"\nüåê –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ: http://localhost:8000/admin/")
    print(f"üìä API —Ä–∞—Å—Å—ã–ª–æ–∫: http://localhost:8000/api/newsletters/")


if __name__ == '__main__':
    main()
